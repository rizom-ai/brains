# Validate workspace structure
echo "☔️ Checking workspace..."
bun run workspace:check

# Fix directory permissions (prevent Docker permission issues)
echo "🔒 Fixing directory permissions..."
find . -type d -perm 700 ! -path "./.git/*" ! -path "*/node_modules/*" -exec chmod 755 {} \; 2>/dev/null || true

# Check dependency versions
echo "🔍 Checking dependency versions..."
bun run deps:check

# Format staged files only (fast!)
echo "📐 Formatting staged files..."
bunx lint-staged

# Run linting on all packages (cached by turbo)
echo "🔍 Running linter..."
bun run lint:fix

# Run type checking on all packages (required for monorepo correctness)
echo "🔍 Running type checks..."
bun run typecheck

# Run tests on all packages (required for monorepo correctness)
echo "🧪 Running tests..."
bun run test