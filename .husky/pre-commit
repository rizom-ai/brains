# Validate workspace structure
echo "â˜”ï¸ Checking workspace..."
bun run workspace:check

# Fix directory permissions (prevent Docker permission issues)
echo "ğŸ”’ Fixing directory permissions..."
find . -type d -perm 700 ! -path "./.git/*" ! -path "*/node_modules/*" -exec chmod 755 {} \; 2>/dev/null || true

# Check dependency versions
echo "ğŸ” Checking dependency versions..."
bun run deps:check

# Format staged files only (fast!)
echo "ğŸ“ Formatting staged files..."
bunx lint-staged

# Run linting on all packages (cached by turbo)
echo "ğŸ” Running linter..."
bun run lint:fix

# Run type checking on all packages (required for monorepo correctness)
echo "ğŸ” Running type checks..."
bun run typecheck

# Run tests on all packages (required for monorepo correctness)
echo "ğŸ§ª Running tests..."
bun run test